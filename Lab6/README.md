# CS-554 Lab 06 - Lab 1 Revisited...

For this lab you will be using TypeScript to redo Lab 1.

You will need to install TypeScript 

`npm install -g typescript`

You will need to install ts-node

`npm install -g ts-node`

You will need to install the express type definitions:

`npm install @types/express --save`

 You will need to install the MongoDb type definitions:

`npm install @types/mongodb --save`

**All of the requirements are the same as they were for lab 1 except you will use TS.**

**Use TS for your express server and routes as shown in the lecture code, Make sure all the variables that you use are typed as well as all functions/data functions your application uses and use the Mongo types for mongo related functions.**

**You will need to submit your project with the TS files. Make sure you test building them before you submit the lab**

## Reviewing API Development

For this lab, you will submit a web server with the supplied routes and middlewares.

| Verb | Route | Description |
| --- | --- | --- |
| GET | /api/tasks | Shows a list of tasks. By default, it will show the first 20 tasks in the collection. If a [querystring](http://expressjs.com/en/api.html#req.query) variable `?skip=n` is provided, you will skip the first `n` tasks. If a querystring variable `?take=y` is provided, it will show `y` number of results. By default, the route will show up to `20` tasks; at most, it will show `100` tasks. |
| GET | /api/tasks/:id | Shows the task with the supplied ID |
| POST | /api/tasks | Creates a task with the supplied detail and returns created object; fails request if not all details supplied |
| PUT | /api/tasks/:id | Updates the task with the supplied ID and returns the new task object; **task**: PUT calls must provide all details of the new state of the object! **Note** you cannot manipulate comments in this route! |
| PATCH | /api/tasks/:id | Updates the task with the supplied ID and returns the new task object; **task**: PATCH calls only provide deltas of the value to update! **Note** you cannot manipulate comments in this route! |
| POST | /api/tasks/:id/comments | Adds a new comment to the task; ids must be generated by the server, and not supplied |
| DELETE | /api/tasks/:taskId/:commentId | Deletes the comment with an id of `commentId` on the task with an id of `taskId` |

All PUT, POST, and PATCH routes expect their content to be in JSON format, supplied in the body.

All routes will return JSON.

## Logging middleware

You will write and apply two middlewares:

1. The first will log all request bodies, as well as the url path they are requesting, and the HTTP verb they are using to make the request
2. The second will keep track of many times a particular URL has been requested, updating and logging with each request.

## Database

You will use a module to abstract out the database calls.

You may find it helpful to reference the [CS-546 lecture 6 code](https://github.com/Stevens-CS546/CS-546-WS-Summer-1/tree/master/Lecture%20Code/lecture_06).

You will store all data in a database named as such: `LastName-FirstName-CS554-Lab1`.

You may name the collection however you would like.

**All ids must be generated by the server and be sufficiently random!**

## The task object

```none
{
  "id": uuid,
  "title": string,
  "description": string,
  "hoursEstimated": number,
  "completed": boolean,
  "comments": comment[]
}
```

## The comment object

```none
{
  "id": uuid,
  "name": string,
  "comment": string
}
```

### Example task:

```none
{
  "id": "956f8670-3bb3-460f-88cd-24ca7ee9091f",
  "title": "Make lab",
  "description": "Make the first lab for CS-554. Maybe talk about dinosaurs in it, or something",
  "hoursEstimated": 1,
  "completed": false,
  "comments": [
    {
        "id": "d0feb7c1-d4a8-4ca6-a8a7-2ed0a0189e28",
        "name": "Phil",
        "comment": "Considering lab about dinosaurs"
    },
    {
        "id": "3b4e3555-77d3-42af-ae38-03e463e95292",
        "name": "Jason",
        "comment": "Don't do dinosaurs..."
    },
    {
        "id": "294b9ef4-255b-4869-b6d1-105eece8add8",
        "name": "Phil",
        "comment": "Maybe make lab about REST?"
    },
    {
        "id": "8372caad-0ec2-477a-a496-1b64534759ec",
        "name": "Jason",
        "comment": "Definitely about REST."
    },
    {
        "id": "6f7098df-fede-45b5-9a20-5e85c107ada8,
        "name": "Phil",
        "comment": "Would dinosaurs agree with the idempotent standards of REST?"
    },
    {
        "id": "4db0a278-41aa-4e90-add8-2671b48cdb2b",
        "name": "Phil",
        "comment": "Do androids dream of electric velociraptors?"
    }
  ]
}
```

## Error Checking

1. You must error check all routes
2. You must fail with proper and valid HTTP status codes depending on the failure type

## Notes

1. Remember to submit your `package.json` file but **not** your `node_modules` folder.

## Steps to Run

### Restore Database

`mongorestore -d shaikh-zubair-cs554-lab06 db/shaikh-zubair-cs554-lab06`

### Test

`npm test`

### Build

`npm run build`

### Run after Build

`npm start`

### Run in Dev mode

`npm run dev`

### Run in Prod mode

`npm run prod`
